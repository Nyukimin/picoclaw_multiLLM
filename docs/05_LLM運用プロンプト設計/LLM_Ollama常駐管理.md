# Ollama（Windows常駐）× PicoClaw（Ubuntu監視）構成設計書 v1.0

## 1. 結論

監視はUbuntu側（PicoClaw）に配置するのが最も安定する。
復旧処理はWindows側に残す二段構えが最小事故構成。

------------------------------------------------------------------------

## 2. 全体構成

### Windows側

-   Ollama常駐（サービス起動）
-   chat-v1 / worker-v1 を warmup で Forever 化
-   復旧スクリプト（Task Scheduler）

### Ubuntu側

-   PicoClaw が定期ヘルスチェック
-   異常時に通知
-   必要に応じて復旧トリガー実行

------------------------------------------------------------------------

## 3. 監視対象

1.  Ollama API 生存確認
    -   GET /api/tags が HTTP 200 を返す
2.  モデル常駐確認
    -   chat-v1 が loaded
    -   worker-v1 が loaded
3.  応答時間監視
    -   応答 p95 を測定（例: 2秒超で警告）
4.  連続失敗回数
    -   3回連続失敗で異常判定

------------------------------------------------------------------------

## 4. 復旧フロー

1.  Ubuntu側で異常検知
2.  Slack/LINEへ通知
3.  Windows復旧トリガー実行
    -   warmupスクリプト再実行
4.  再確認
5.  成功/失敗ログ記録

------------------------------------------------------------------------

## 5. 役割分担

  項目       Windows   Ubuntu
  ---------- --------- -------------
  LLM実行    ○         \-
  warmup     ○         \-
  監視       \-        ○
  通知       \-        ○
  復旧実行   ○         ○(トリガー)

------------------------------------------------------------------------

## 6. 安定運用の理由

-   Windowsは更新・スリープ等で不安定要素がある
-   Ubuntu + systemd は常駐監視に向いている
-   監視と実行を分離することで単一点障害を減らせる

------------------------------------------------------------------------

## 7. 運用サーバ情報（固定）

- OllamaサーバIP: `100.83.207.6`
- ホスト名: `kawaguchike-llm`
- Tailscale FQDN: `kawaguchike-llm.tailb07d8d.ts.net`
- OS: Windows
- 想定エンドポイント: `http://100.83.207.6:11434`

------------------------------------------------------------------------

## 8. Definition of Done

-   Windows再起動後にモデルが自動復帰
-   Ubuntuが定期的にAPI生存確認
-   異常時に即通知される
-   復旧成功率が99%以上
